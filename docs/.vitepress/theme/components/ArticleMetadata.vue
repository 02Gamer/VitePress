<script lang="ts" setup>
import { useData } from 'vitepress'
import { computed, ref, onMounted } from 'vue'
import { countWord } from '../untils/functions'

const { page } = useData()
const date = computed(
  () => new Date(page.value.lastUpdated!)
)

const wordCount = ref(0)
const imageCount = ref(0)

const wordTime = computed(() => {
    return ((wordCount.value / 275) * 60)
})

const imageTime = computed(() => {
    const n = imageCount.value
    if (imageCount.value <= 10) {
        // 等差数列求和
        return n * 13 + (n * (n - 1)) / 2
    }
    return 175 + (n - 10) * 3
})

// 阅读时间
const readTime = computed(() => {
    return Math.ceil((wordTime.value + imageTime.value) / 60)
})


function analyze() {
    document.querySelectorAll('.meta-des').forEach(v => v.remove())
    const docDomContainer = window.document.querySelector('#VPContent')
    const imgs = docDomContainer?.querySelectorAll<HTMLImageElement>(
        '.content-container .main img'
    )
    imageCount.value = imgs?.length || 0
    const words = docDomContainer?.querySelector('.content-container .main')?.textContent || ''
    wordCount.value = countWord(words)
}

onMounted(() => {
    // 初始化时执行一次
    analyze()
})
</script>


<template>
    <div class="word">
        <p>
            <svg t="1746147178812" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="37650" width="16" height="16"><path d="M797.65272793 932.51126548l80.93493963-39.61051117c9.90262743 36.18267951 15.23481164 74.65057911 15.23481164 113.68978599v8.18871158h-87.98103968v-6.47479574c0-25.70874483-2.85652736-50.84618537-8.18871159-75.79319066z m-153.87160293-217.47694309c-52.36966742-32.56441111-113.11848021-50.08444435-175.39077507-50.08444434-185.86470826 0-336.87978382 153.30029715-336.87978381 342.59283707v6.47479576H43.7199617v-8.18871159c0-201.0995199 135.7802639-370.01550068 318.78844479-417.81472344-113.68978599-45.51400114-188.14992986-156.15682453-188.14993133-278.60662641 0-164.91684188 131.781125-299.55449426 294.22231003-299.55449426 162.06031452 0 294.22231003 134.0663466 294.22231002 299.55449426 0 127.02024656-78.07841226 235.37784831-188.14992986 278.60662641 39.61051116 10.47393318 78.07841226 26.85135636 113.11848023 48.37052851l-43.99052058 78.64971803zM263.86299689 309.59788471c0 114.83239605 91.98017858 208.52649196 204.52735304 208.52649046 113.11848021 0 204.52735302-93.3132239 204.52735305-208.52649046 0-114.83239605-91.98017858-208.52649196-204.52735305-208.52649196-112.35673921 0.38087052-204.52735302 93.69409441-204.52735304 208.52649196z m713.37007879 173.4864225c-2.85652736 20.94786639-6.47479575 43.0383443-11.04523897 67.60447907-4.5704432 23.80439375-9.33132311 48.37052853-14.66350586 72.9366633-4.5704432 22.66178369-9.90262743 44.94269538-15.80611741 67.60447906L863.54328969 731.41174557c8.76001737-2.85652736 17.52003325-4.5704432 25.70874631-7.61740582 7.04610006-2.2852216 14.47307211-4.5704432 22.09047791-6.47479576 7.61740581-2.2852216 13.90176631-3.99913891 18.66264479-6.47479429l-7.61740581 29.13657798c-2.2852216 8.18871158-3.99913891 14.47307211-5.90349 18.09133903-3.42783314 9.90262743-8.18871158 19.23395055-12.7591548 27.42266211-4.5704432 8.76001737-9.90262743 15.80611741-13.33046055 22.09047794-4.5704432 7.04610006-9.90262743 14.47307211-15.80611889 19.80525483l-66.46186753 19.80525631L862.40067964 857.09894533c-7.04610006 6.47479575-15.23481164 12.18784901-23.23308799 19.23395055-7.04610006 5.33218423-15.23481164 11.04523897-24.56613478 17.52003472-9.33132311 6.47479575-19.23395055 11.61654474-29.13657944 16.37742318-10.47393318 5.33218423-22.09047791 7.61740581-33.70702117 8.18871158-12.18784901 0-23.80439375-0.57130577-35.04006795-2.85652737-13.33046055-1.71391584-26.28005061-5.33218423-38.4679011-9.33132312 3.99913891-6.47479575 8.18871158-12.75915479 12.75915625-20.94786636 3.99913891-7.04610006 8.76001737-14.66350735 14.47307063-23.23308799s11.61654474-18.66264478 17.52003471-29.70788375c16.94872895-29.70788373 33.70702116-58.27315595 50.08444436-86.8384296s30.85049529-54.27401852 43.60965006-77.50710651c15.23481164-26.85135636 29.13657798-51.79836166 42.46703853-75.79319067-16.94872895 19.80525632-35.04006796 41.89573277-53.70271274 66.46186755-18.66264478 24.56613478-36.7539838 48.94183428-54.27401852 74.07927482-20.94786639 30.85049529-41.32442846 62.27229485-60.55837754 94.45583397-4.5704432 7.04610006-9.33132311 15.23481164-14.4730721 23.80439523-5.33218423 8.76001737-11.04523897 18.66264478-16.94872895 29.13657796-5.90348999 10.47393318-11.61654474 20.37656061-18.66264477 31.42179958-5.90348999 10.47393318-12.18784901 21.51917215-18.66264478 31.42179956-14.47307211 23.80439375-29.13657798 48.94183428-44.37138961 74.6505806 0.57130577-7.61740581 1.71391584-17.52003325 3.99913743-29.70788373 2.2852216-10.47393318 5.90348999-23.23308798 11.04523896-38.4679011 4.5704432-15.23481164 12.18784901-33.70702116 21.51917213-54.27401852 6.47479575-12.75915479 11.04523897-23.23308798 13.90176633-30.8504938s5.90348999-12.75915479 7.61740583-16.94872894c1.14261153-2.85652736 2.2852216-6.47479575 4.57044319-8.76001737-1.71391584-2.2852216-2.2852216-6.47479575-0.57130429-12.75915479 0.57130577-5.90348999 2.2852216-14.47307211 6.47479428-25.70874631 3.42783314-11.04523897 9.33132311-26.85135636 17.52003471-46.65661121 8.18871158-20.37656061 19.23395055-42.46703853 32.56441112-65.89056323 13.33046055-23.80439375 28.56527221-46.65661268 45.51400116-69.88970069 16.94872895-23.23308798 35.61137374-46.08530691 54.84532279-67.60447905 18.66264478-20.94786639 39.03920687-40.18181694 60.55837902-58.27315596 20.37656061-16.94872895 41.32442846-30.85049529 61.70098908-41.32442846s40.7531227-16.94872895 59.98707325-18.09133901c2.47565685 12.94959005 1.33304678 29.70788373-1.52348205 50.65575012z" p-id="37651"></path></svg>
            作者: Gamers
            <!-- <svg t="1724572866572" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18131" width="16" height="16"><path d="M168.021333 504.192A343.253333 343.253333 0 0 1 268.629333 268.8a342.229333 342.229333 0 0 1 243.285334-100.778667A341.504 341.504 0 0 1 755.029333 268.8c9.856 9.898667 19.2 20.394667 27.733334 31.402667l-60.16 46.976a8.021333 8.021333 0 0 0 2.986666 14.122666l175.701334 43.008a8.021333 8.021333 0 0 0 9.898666-7.68l0.810667-180.906666a7.936 7.936 0 0 0-12.885333-6.314667L842.666667 253.44a418.858667 418.858667 0 0 0-330.922667-161.493333c-229.12 0-415.488 183.594667-419.797333 411.818666a8.021333 8.021333 0 0 0 8.021333 8.192H160a7.978667 7.978667 0 0 0 8.021333-7.808zM923.946667 512H864a7.978667 7.978667 0 0 0-8.021333 7.808 341.632 341.632 0 0 1-26.88 125.994667 342.186667 342.186667 0 0 1-73.685334 109.397333 342.442667 342.442667 0 0 1-243.328 100.821333 342.229333 342.229333 0 0 1-270.976-132.224l60.16-46.976a8.021333 8.021333 0 0 0-2.986666-14.122666l-175.701334-43.008a8.021333 8.021333 0 0 0-9.898666 7.68l-0.682667 181.034666c0 6.698667 7.68 10.496 12.885333 6.314667L181.333333 770.56a419.072 419.072 0 0 0 330.922667 161.408c229.205333 0 415.488-183.722667 419.797333-411.818667a8.021333 8.021333 0 0 0-8.021333-8.192z" fill="#8a8a8a" p-id="18132"></path></svg>
            更新: {{ date.toLocaleDateString() }} -->
            <svg t="1746147226455" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="39565" width="16" height="16"><path d="M841.155053 1024H181.382826c-54.766249-0.644309-98.579249-44.457308-98.579249-99.223558V108.437174C82.803577 53.670924 126.616576 9.857925 181.382826 9.213616h385.296671c23.839426 0 47.034544 9.020323 64.430882 25.128044l277.05279 245.481658c21.262191 18.684956 33.504058 45.101617 32.85975 73.451205v571.501919c0 26.416661-10.308941 52.189014-28.993897 70.229661-19.329264 18.684956-44.457308 28.993897-70.873969 28.993897zM148.523076 108.437174v816.339268c0 18.040647 14.819103 32.85975 32.85975 32.85975h659.772227c18.040647 0 32.215441-14.819103 32.21544-32.85975v-571.501919a30.346945 30.346945 0 0 0-10.308941-23.839426l-277.05279-245.481658a33.053042 33.053042 0 0 0-21.9065-8.376015H181.382826c-18.040647 0-32.85975 14.819103-32.85975 32.85975z" p-id="39566"></path><path d="M446.515903 356.947084h-160.432895a33.826213 33.826213 0 0 1-24.483735-32.215441c0-14.819103 10.308941-27.705279 24.483735-32.215441h160.432895c14.174794-3.865853 28.349588 1.288618 36.725603 12.886176 8.376015 11.597559 8.376015 27.06097 0 38.658529s-22.550809 16.752029-36.725603 12.886177z m221.642233 194.581262h-382.075128a33.053042 33.053042 0 0 1-26.416661-32.215441c0-16.10772 10.95325-28.993897 26.416661-32.215441h382.075128c14.819103 3.221544 26.416661 16.10772 26.416661 32.215441 0 15.463412-11.597559 28.993897-26.416661 32.215441z m0 194.581262h-382.075128a33.826213 33.826213 0 0 1-24.483735-32.215441c0-14.819103 10.308941-28.349588 24.483735-32.215441h382.075128c14.174794 3.865853 23.839426 17.396338 23.839426 32.215441 0 14.819103-9.664632 28.349588-23.839426 32.215441z m216.487762-384.652363h-321.510099c-9.020323 0-17.396338-3.221544-23.839426-9.020323a35.952432 35.952432 0 0 1-9.664633-23.839426V42.524382c-3.865853-13.530485 1.288618-28.349588 12.886177-36.081294a32.85975 32.85975 0 0 1 38.658529 0c11.597559 7.731706 16.752029 22.550809 12.886176 36.081294v253.213364h287.361731c12.886176-2.577235 26.416661 3.221544 33.504059 14.174794 7.731706 10.95325 7.731706 25.128044 0 36.725603-7.087397 10.95325-20.617882 16.10772-33.504059 13.530485z" p-id="39567"></path></svg>
            字数: {{ wordCount }} 字
            <svg t="1746146966731" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21133" width="16" height="16"><path d="M793.7 881.4c-16.8-0.1-19.6-8.5-19.4-22.1 0.3-30.7-0.4-61.5 0-92.3 0.4-31.9-11.5-58.1-32.8-81.4-35.7-39.2-69.7-80-106.2-118.3-36.7-38.4-36.3-71.5-0.7-109C671 419.9 705 379.1 740.8 340c22.4-24.3 34.3-51.8 33.6-85.1-0.7-30.7 0.1-61.5-0.1-92.3-0.1-12.8 4.2-18.7 18.2-19.1 21.4-0.7 37.4-17.1 38.9-36.8 1.3-17.8-13-35.8-33.2-40.6-6.3-1.5-13-1.7-19.4-1.7-177.8 0.1-355.8 0.1-533.7 0.2-7.7 0-15.7 0.6-23.2 2.6-19.1 5.2-32.1 23.2-30.3 40.5 2.1 19.6 17.3 35.8 37.5 35.9 16.8 0.1 19.6 8.4 19.4 22-0.3 30.7 0.4 61.5 0 92.3-0.4 31.8 11.5 58.1 32.8 81.4 38.7 42.6 76.9 85.7 114.8 129 27.2 31 27 57.4-0.6 88.9-37.9 43.3-76.1 86.4-114.8 129-20.6 22.8-32.5 48.6-32.1 79.7 0.3 30.1-0.5 60.2 0.1 90.3 0.3 16.2-2.7 25.7-22.4 25.4-17.7-0.3-32.6 15.9-34.1 34.6-1.5 17.8 6.2 32.3 23.2 39.3 8.8 3.6 19 4.7 28.7 4.8 89 0.3 177.9 0.2 266.9 0.2s177.9 0.1 266.8-0.1c8.3 0 17.1-0.8 25-3.1 17.8-5.3 30.2-23.6 28.5-39.9-2-19.4-17.5-35.9-37.6-36z m-96.9-20.5c0.4 15.6-6.1 20.3-21 20.1-54.9-0.6-109.9-0.2-164.8-0.2-51.7 0-103.3 0.1-154.9 0-29.6 0-29.6-0.1-29.7-30.7-0.1-17 1.6-34.2-0.4-50.9-3.8-32.1 8.2-56.1 30-78.8 35.7-37.3 69.4-76.5 103.5-115.3 48.2-54.7 47.3-131.9-1.9-187.4-38.6-43.5-78.1-86.3-115.5-130.9-8.8-10.5-13.9-26.4-15.1-40.4-2.4-26.6-0.1-53.6-0.9-80.4-0.4-15.5 4.2-22.2 21.1-22.1 109.9 0.6 219.7 0.4 329.5 0.1 14.1-0.1 20.3 4.4 20 19.1-0.6 29.4 1 59-0.8 88.3-0.7 11.4-5.8 24.6-13.2 33.3-37.7 44.3-76.6 87.6-115.6 130.8-52.5 58.4-52.9 135.1-0.6 193.4 38.8 43.4 77.9 86.6 115.5 130.9 7.8 9.1 13 22.9 13.8 35 2.1 28.5 0.3 57.4 1 86.1z m-57.3-604.4h-256l128 128 128-128z m-256 512v64h256v-64l-128-128-128 128z" p-id="21134"></path></svg>
            时长: {{ readTime }} 分钟
        </p>
    </div>
</template>

<style>
.word {
  color: var(--vp-c-text-2);
  font-size: 15px;
}

.icon {
    display: inline-block;
    transform: translate(0px , 2px);
}
</style>